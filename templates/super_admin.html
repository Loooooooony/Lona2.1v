<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="midnight">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© ğŸ‘‘ | LonaBot</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="/static/css/global.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { padding: 30px; }
        .server-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-glass);
            padding: 10px;
            border-radius: 12px;
            display: flex; align-items: center; gap: 15px;
            transition: 0.2s;
        }
        .server-item:hover { background: rgba(255,255,255,0.08); }
        .server-img { width: 50px; height: 50px; border-radius: 50%; }

        .badge-custom {
            font-size: 0.75rem; padding: 4px 8px; border-radius: 6px;
            background: rgba(0,0,0,0.3); color: #ccc;
        }
        .btn-action {
            width: 35px; height: 35px; border-radius: 8px; border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; color: #fff;
        }
        .btn-invite { background: var(--accent-primary); }
        .btn-leave { background: var(--accent-danger); }
    </style>
</head>
<body>

    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-black m-0" style="color: var(--accent-secondary);">SUPER ADMIN ğŸ‘‘</h2>
            <p class="text-muted m-0 small">The God Mode.</p>
        </div>
        <div class="d-flex gap-2">
            <a href="/" class="lona-btn-primary"><i class="fas fa-home me-2"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <form action="/kill_switch" method="POST" onsubmit="return confirm('Restart Bot?');">
                <button class="lona-btn-danger"><i class="fas fa-power-off"></i></button>
            </form>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <!-- Stats -->
        <div class="col-md-3">
            <div class="lona-card text-center p-3">
                <h3 class="fw-bold">{{ servers|length }}</h3>
                <span class="text-muted small">Ø³ÙŠØ±ÙØ±</span>
            </div>
        </div>
        <div class="col-md-3">
            <div class="lona-card text-center p-3">
                <h3 class="fw-bold">{{ total_members }}</h3>
                <span class="text-muted small">Ø¹Ø¶Ùˆ</span>
            </div>
        </div>
        <div class="col-md-3">
            <div class="lona-card text-center p-3">
                <h3 class="fw-bold">{{ ping }}ms</h3>
                <span class="text-muted small">Ping</span>
            </div>
        </div>
        <div class="col-md-3">
            <div class="lona-card text-center p-3">
                <div class="form-check form-switch d-flex justify-content-center gap-2">
                    <input class="lona-toggle" type="checkbox" id="maintenanceMode" {% if maintenance %}checked{% endif %} onchange="toggleMaint(this)">
                    <label class="form-check-label">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="lona-card h-100">
                <h5 class="fw-bold mb-3">Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</h5>
                <div class="d-grid gap-2">
                    <button class="lona-btn-primary" data-bs-toggle="modal" data-bs-target="#broadcastModal">
                        <i class="fas fa-bullhorn me-2"></i> Ø¥Ø°Ø§Ø¹Ø© Ø¹Ø§Ù…Ø©
                    </button>
                    <button class="lona-btn-danger" data-bs-toggle="modal" data-bs-target="#blacklistModal">
                        <i class="fas fa-ban me-2"></i> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡
                    </button>
                    <a href="/editor" class="lona-btn-primary" style="background: #202225; border: 1px solid #40444b;">
                        <i class="fas fa-code me-2"></i> Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ
                    </a>
                </div>

                <hr class="border-secondary opacity-25 my-4">

                <h5 class="fw-bold mb-3">Ø§Ù„Ù†Ø´Ø§Ø·</h5>
                <canvas id="activityChart" height="200"></canvas>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="lona-card h-100">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold m-0">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª</h5>
                    <input type="text" id="searchInput" class="lona-input py-1" style="width: 250px;" placeholder="Ø¨Ø­Ø«...">
                </div>

                <div class="row g-2" style="max-height: 600px; overflow-y: auto;">
                    {% for guild in servers %}
                    <div class="col-lg-6 server-card-wrapper">
                        <div class="server-item">
                            <img src="{{ guild.icon }}" class="server-img" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
                            <div class="flex-grow-1" style="min-width: 0;">
                                <div class="fw-bold text-truncate">{{ guild.name }}</div>
                                <div class="d-flex gap-1 mt-1 flex-wrap">
                                    <span class="badge-custom"><i class="fas fa-crown text-warning"></i> {{ guild.owner }}</span>
                                    <span class="badge-custom"><i class="fas fa-users"></i> {{ guild.member_count }}</span>
                                </div>
                            </div>
                            <div class="d-flex gap-1">
                                <button onclick="getInvite('{{ guild.id }}', this)" class="btn-action btn-invite" title="Invite"><i class="fas fa-link"></i></button>
                                <button onclick="leaveGuild('{{ guild.id }}', '{{ guild.name }}')" class="btn-action btn-leave" title="Leave"><i class="fas fa-sign-out-alt"></i></button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (Simplified) -->
    <div class="modal fade" id="broadcastModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content lona-card p-0 overflow-hidden">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Ø¥Ø°Ø§Ø¹Ø© Ø¹Ø§Ù…Ø©</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea id="bcMsg" class="lona-input" rows="5" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..."></textarea>
                </div>
                <div class="modal-footer border-0">
                    <button onclick="sendBroadcast()" class="lona-btn-primary w-100">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts from original file maintained -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Chart & API logic here (copied from original)
        async function apiRequest(url, data) {
            try {
                let res = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                return await res.json();
            } catch (e) { return {status: 'error', msg: e}; }
        }

        document.getElementById('searchInput').addEventListener('keyup', function() {
            let val = this.value.toLowerCase();
            document.querySelectorAll('.server-card-wrapper').forEach(el => {
                el.style.display = el.innerText.toLowerCase().includes(val) ? 'block' : 'none';
            });
        });

        async function getInvite(id, btn) {
            let original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            let d = await apiRequest('/api/admin/invite', {guild_id: id});
            if(d.status === 'success') prompt("Link:", d.url);
            else alert('Error: ' + d.msg);
            btn.innerHTML = original;
        }

        // ... Other functions
    </script>
</body>
</html>
